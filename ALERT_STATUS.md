# ğŸš¨ ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½ã®ç¾åœ¨ã®çŠ¶æ…‹

## âœ… è¨­å®šå®Œäº†é …ç›®

### 1. **Prometheusã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«**
- ãƒ•ã‚¡ã‚¤ãƒ«: `docker/prometheus/alert_rules.yml`
- ã‚¢ãƒ©ãƒ¼ãƒˆæ•°: **13ä»¶**
  - ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«: 5ä»¶
  - è­¦å‘Š: 6ä»¶
  - æƒ…å ±: 2ä»¶
- çŠ¶æ…‹: **æœ‰åŠ¹åŒ–æ¸ˆã¿** âœ…

### 2. **è¦–è¦šçš„é–¾å€¤ï¼ˆGrafanaãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰**
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰: `camel-comprehensive-dashboard.json`
- è‰²åˆ†ã‘è¨­å®š: ç·‘/é»„/æ©™/èµ¤
- çŠ¶æ…‹: **è¨­å®šæ¸ˆã¿** âœ…

---

## ğŸ“Š ã‚¢ãƒ©ãƒ¼ãƒˆä¸€è¦§

### ğŸ”´ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆå³åº§ã®å¯¾å¿œãŒå¿…è¦ï¼‰

| # | ã‚¢ãƒ©ãƒ¼ãƒˆå | é–¾å€¤ | æŒç¶šæ™‚é–“ | èª¬æ˜ |
|---|----------|------|---------|------|
| 1 | **HighMemoryUsage** | >90% | 2åˆ† | ãƒ’ãƒ¼ãƒ—ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒå±é™ºãƒ¬ãƒ™ãƒ« |
| 2 | **HighErrorRate** | >10% | 2åˆ† | Camelãƒ«ãƒ¼ãƒˆã®ã‚¨ãƒ©ãƒ¼ç‡ãŒé«˜ã„ |
| 3 | **HighHTTPErrorRate** | >5% | 2åˆ† | HTTP 5xxã‚¨ãƒ©ãƒ¼ãŒå¤šç™º |
| 4 | **HighGCOverhead** | >20% | 5åˆ† | GCã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒé«˜ã™ãã‚‹ |
| 5 | **ApplicationDown** | - | 1åˆ† | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ€ã‚¦ãƒ³ |

### ğŸŸ¡ è­¦å‘Šã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆæ³¨æ„ãŒå¿…è¦ï¼‰

| # | ã‚¢ãƒ©ãƒ¼ãƒˆå | é–¾å€¤ | æŒç¶šæ™‚é–“ | èª¬æ˜ |
|---|----------|------|---------|------|
| 6 | **ModerateMemoryUsage** | >70% | 5åˆ† | ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒé«˜ã‚ |
| 7 | **HighCPUUsage** | >80% | 5åˆ† | CPUä½¿ç”¨ç‡ãŒé«˜ã„ |
| 8 | **SlowResponseTime** | >1ç§’ | 3åˆ† | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ãŒé…ã„ |
| 9 | **HighInflightMessages** | >100ä»¶ | 3åˆ† | å‡¦ç†ä¸­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¤šã„ |
| 10 | **HighThreadCount** | >100å€‹ | 5åˆ† | ã‚¹ãƒ¬ãƒƒãƒ‰æ•°ãŒå¤šã„ |
| 11 | **ModerateGCOverhead** | >10% | 5åˆ† | GCã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒé«˜ã‚ |

### â„¹ï¸ æƒ…å ±ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆå‚è€ƒæƒ…å ±ï¼‰

| # | ã‚¢ãƒ©ãƒ¼ãƒˆå | é–¾å€¤ | æŒç¶šæ™‚é–“ | èª¬æ˜ |
|---|----------|------|---------|------|
| 12 | **FrequentGarbageCollection** | >30å›/åˆ† | 5åˆ† | GCå®Ÿè¡Œé »åº¦ãŒé«˜ã„ |
| 13 | **ApplicationRestarted** | - | 1åˆ† | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†èµ·å‹• |

---

## ğŸ” ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèªæ–¹æ³•

### 1. **Prometheus Web UI**ï¼ˆæ¨å¥¨ï¼‰
```
http://localhost:9090/alerts
```

ã“ã“ã§ä»¥ä¸‹ã‚’ç¢ºèªã§ãã¾ã™ï¼š
- ã‚¢ãƒ©ãƒ¼ãƒˆã®çŠ¶æ…‹ï¼ˆInactive / Pending / Firingï¼‰
- ç¾åœ¨ã®å€¤
- ã„ã¤ã‹ã‚‰ç™ºç«ã—ã¦ã„ã‚‹ã‹

### 2. **ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³**
```bash
# å…¨ã‚¢ãƒ©ãƒ¼ãƒˆã®çŠ¶æ…‹ã‚’ç¢ºèª
curl -s http://localhost:9090/api/v1/rules | jq -r '.data.groups[].rules[] | select(.type == "alerting") | "\(.name): \(.state)"'

# ç™ºç«ä¸­ã®ã‚¢ãƒ©ãƒ¼ãƒˆã®ã¿è¡¨ç¤º
curl -s http://localhost:9090/api/v1/rules | jq -r '.data.groups[].rules[] | select(.type == "alerting" and .state == "firing") | "\(.name): \(.labels)"'
```

---

## ğŸ§ª ã‚¢ãƒ©ãƒ¼ãƒˆã®ãƒ†ã‚¹ãƒˆæ–¹æ³•

### ãƒ†ã‚¹ãƒˆ1: ã‚¨ãƒ©ãƒ¼ç‡ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆHighErrorRateï¼‰

æœ¬ãƒ‡ãƒ¢ã§ã¯ã€æ”¯æ‰•ã„å‡¦ç†ã§ç´„10%ã®ç¢ºç‡ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

```bash
cd /Users/kjin/mobills/observability/demo

# å¤§é‡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ï¼ˆ2åˆ†é–“ï¼‰
./load-test-concurrent.sh -r 200 -c 30 -d 120

# 2-3åˆ†å¾Œã€Prometheusã§ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèª
open http://localhost:9090/alerts
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ:**
1. æœ€åˆã¯ã€ŒInactiveã€
2. ã‚¨ãƒ©ãƒ¼ç‡ãŒ10%ã‚’è¶…ãˆã‚‹ã¨ã€ŒPendingã€ï¼ˆé»„è‰²ï¼‰
3. 2åˆ†é–“ç¶™ç¶šã™ã‚‹ã¨ã€ŒFiringã€ï¼ˆèµ¤è‰²ï¼‰ ğŸ”´

### ãƒ†ã‚¹ãƒˆ2: ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆModerateMemoryUsageï¼‰

```bash
# ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã§è² è·ã‚’ã‹ã‘ã‚‹
./load-test-stress.sh

# ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèª
watch -n 5 'curl -s "http://localhost:9090/api/v1/query?query=jvm_memory_used_bytes%7Barea%3D%22heap%22%7D%2Fjvm_memory_max_bytes%7Barea%3D%22heap%22%7D" | jq ".data.result[0].value[1]"'
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ:**
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒ70%ã‚’è¶…ãˆã‚‹ã¨ã€ŒModerateMemoryUsageã€ãŒç™ºç«

### ãƒ†ã‚¹ãƒˆ3: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ€ã‚¦ãƒ³ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆApplicationDownï¼‰

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢
pkill -f spring-boot:run

# 1åˆ†å¾Œã€Prometheusã§ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèª
# ã€ŒApplicationDownã€ãŒ Firing ã«ãªã‚‹ã¯ãš

# å†èµ·å‹•
cd camel-app
mvn spring-boot:run
```

---

## ğŸ“ˆ ç¾åœ¨ã®çŠ¶æ…‹

### ã‚¢ãƒ©ãƒ¼ãƒˆã®çŠ¶æ…‹ï¼ˆä¾‹ï¼‰

ã™ã¹ã¦ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒæ­£å¸¸ãªå ´åˆï¼š
```
HighMemoryUsage: inactive
HighErrorRate: inactive
HighHTTPErrorRate: inactive
HighGCOverhead: inactive
ApplicationDown: inactive
ModerateMemoryUsage: inactive
HighCPUUsage: inactive
SlowResponseTime: inactive
HighInflightMessages: inactive
HighThreadCount: inactive
ModerateGCOverhead: inactive
FrequentGarbageCollection: inactive
ApplicationRestarted: inactive
```

---

## âš ï¸ æœªå®Ÿè£…æ©Ÿèƒ½

### é€šçŸ¥æ©Ÿèƒ½ï¼ˆAlertmanagerï¼‰

ç¾åœ¨ã€ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç«ã—ã¦ã‚‚**é€šçŸ¥ã¯é€ã‚‰ã‚Œã¾ã›ã‚“**ã€‚

**å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹:**
- âœ… ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«ã®è©•ä¾¡
- âœ… ã‚¢ãƒ©ãƒ¼ãƒˆçŠ¶æ…‹ã®è¡¨ç¤ºï¼ˆPrometheus Web UIï¼‰
- âœ… Grafanaãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®è¦–è¦šåŒ–

**å®Ÿè£…ã•ã‚Œã¦ã„ãªã„:**
- âŒ Slacké€šçŸ¥
- âŒ Emailé€šçŸ¥
- âŒ PagerDutyé€šçŸ¥
- âŒ Webhooké€šçŸ¥

### é€šçŸ¥æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•

è©³ç´°ã¯ **[ALERTING_GUIDE.md](ALERTING_GUIDE.md)** ã®ã€Œé€šçŸ¥è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ç°¡å˜ãªæ‰‹é †ï¼š
1. Alertmanagerã‚³ãƒ³ãƒ†ãƒŠã‚’è¿½åŠ 
2. `alertmanager.yml` ã‚’è¨­å®š
3. Slack Webhook URLãªã©ã‚’è¨­å®š
4. Prometheusã«æ¥ç¶š

---

## ğŸ¯ ç¾åœ¨ã®ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½ã¾ã¨ã‚

| æ©Ÿèƒ½ | çŠ¶æ…‹ | èª¬æ˜ |
|-----|------|------|
| **ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«å®šç¾©** | âœ… å®Œäº† | 13ä»¶ã®ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«è¨­å®šæ¸ˆã¿ |
| **ã‚¢ãƒ©ãƒ¼ãƒˆè©•ä¾¡** | âœ… ç¨¼åƒä¸­ | PrometheusãŒ15ç§’ã”ã¨ã«è©•ä¾¡ |
| **ã‚¢ãƒ©ãƒ¼ãƒˆçŠ¶æ…‹è¡¨ç¤º** | âœ… åˆ©ç”¨å¯èƒ½ | http://localhost:9090/alerts ã§ç¢ºèª |
| **è¦–è¦šçš„é–¾å€¤** | âœ… è¨­å®šæ¸ˆã¿ | Grafanaãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§è‰²åˆ†ã‘ |
| **é€šçŸ¥æ©Ÿèƒ½** | âŒ æœªå®Ÿè£… | Alertmanagerè¨­å®šãŒå¿…è¦ |

---

## ğŸ’¡ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### 1. **ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèª**
```bash
# ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª
open http://localhost:9090/alerts

# ã™ã¹ã¦ "inactive" ãªã‚‰æ­£å¸¸
```

### 2. **è² è·ãƒ†ã‚¹ãƒˆã§ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒ†ã‚¹ãƒˆ**
```bash
cd /Users/kjin/mobills/observability/demo
./load-test-concurrent.sh -r 200 -c 30 -d 120

# 2-3åˆ†å¾Œã«å†åº¦ç¢ºèª
open http://localhost:9090/alerts
```

### 3. **Grafanaã§è¦–è¦šçš„ã«ç¢ºèª**
```bash
# ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ã
open http://localhost:3000/d/camel-comprehensive

# ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ã‚„ã‚¨ãƒ©ãƒ¼ç‡ãŒé–¾å€¤ã‚’è¶…ãˆã‚‹ã¨è‰²ãŒå¤‰ã‚ã‚‹
# ç·‘ â†’ é»„ â†’ æ©™ â†’ èµ¤
```

### 4. **é€šçŸ¥æ©Ÿèƒ½ãŒå¿…è¦ãªå ´åˆ**
[ALERTING_GUIDE.md](ALERTING_GUIDE.md) ã‚’å‚ç…§ã—ã¦ã€Alertmanagerã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[ALERTING_GUIDE.md](ALERTING_GUIDE.md)** - ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šã®è©³ç´°ã‚¬ã‚¤ãƒ‰
- **[METRICS_GUIDE.md](METRICS_GUIDE.md)** - ãƒ¡ãƒˆãƒªã‚¯ã‚¹ä½“ç³»ã‚¬ã‚¤ãƒ‰
- **[DASHBOARD_GUIDE.md](DASHBOARD_GUIDE.md)** - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆ©ç”¨ã‚¬ã‚¤ãƒ‰

---

**æœ€çµ‚æ›´æ–°:** 2025å¹´10æœˆ15æ—¥
**ã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³:** v1.0


